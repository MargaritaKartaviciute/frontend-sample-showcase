# Code Walk-through

1. ViewClipApp.tsx      Lines 17-22 - (Standard) View setup used by all samples. Utilize `getIsoView` as an isometric view looks more interesting when the clip is applied. Include an iModel selector from `useSampleWidget`.
1. ViewClipApp.tsx      Lines 30-39 - (Standard) `<Viewer>` component from itwin-viewer-react to display the iModel.
1. ViewClipWidget.tsx   Lines 17-18 - This sample has two state members. `showClipBlockState` - Whether or not to show the view clip block (defaults to true). `clipPlaneState` - The plane the clip should use (defaults to "None"). Changes in state variables results in calls to ViewClipApi. Next, we will see how ViewClipApi applies the clips.
1. ViewClipApi.ts       Lines 13-17 - Method for clearing clips in the view. Simply run `ViewClipClearTool` using IModelApp. Also clear the decorators by creating and toggling a blank `ViewClipDecorationProvider`.
1. ViewClipApi.ts       Lines 20-28 - Method for adding decorators to the viewport. The decorators, in this case, are the arrows that can be dragged to adjust the clip and the border around the clip. To do this, we first create a `ViewClipDecorationProvider`. By default, the decorators are hidden on deselect, because this example is all about view clipping, we don't want this behavior, so `clearDecorationOnDeselect` is set to false. Next, `showDecoration` is called. Finally, the decorators require the SelectTool being active, so `IModelApp.toolAdmin.startDefaultTool()` will take care of that requirement.
1. ViewClipApi.ts       Lines 31-46 - This method adds a clip range around our model. In this example, the method adds the clip range around the extents of the model, then clips the top half of the z-range.
1. ViewClipApi.ts       Lines 32-35 - First, the range is computed and adjusted to fit the purpose of this example.
1. ViewClipApi.ts       Lines 36-41 - Next, a `ClipShape` and `ClipVector` are created. The `ClipShape` defines the shape of the clipping volume, while the `ClipVector` is an array of shapes that can be passed to the viewport of clipping.
1. ViewClipApi.ts       Lines 42-45 - Finally, `ViewClipTool.enableClipVolume` is called. This will ensure all the proper view clipping flags are set in the viewport. The `ClipVector` is added to the viewport, and the `addDecorators` method is invoked. The clip range will be added to the viewport.
1. ViewClipApi.ts       Lines 48-71 - The other feature of this sample is adding a clipping plane. This method accepts clipPane (X, Y, or Z) and adds the clip to the viewport.
1. ViewClipApi.ts       Lines 50-57 - Translate the inputted `clipPlane` value to an `EditManipulator.RotationType` value.
1. ViewClipApi.ts       Lines 60-61 - For this example, we will place the clip plane in the middle of the `displayedExtents`. In practice, the clip plane could be placed elsewhere - at the location of a selected element, for example. Next, we must find the normal vector of the plane.
1. ViewClipApi.ts       Lines 73-79 - Given a `RotationType`, find the inward normal. A matrix is returned from `EditManipulator.HandleUtils.getRotation`. The second column of the returned matrix is the vector we need. (TODO: Make this easier by using more ClipPlaneTools.)
1. ViewClipApi.ts       Lines 62-70 - Now that we have the required point (center point), and normal vector, we create a `Plane3dByOriginAndUnitNormal` that will define the clip. This is added to a `ConvexClipPlaneSet` and passed to the last method `setViewClipFromClipPlaneSet`.
1. ViewClipApi.ts       Lines 81-89 - A method that will apply a clip plane to the viewport. As before, a `ClipVector` is set up using the desired `ConvexClipPlaneSet`. The `ClipVector` is added to the viewport, and the decorators are turned on.
1. ViewClipWidget.tsx   Lines 85-99 - Now that we've seen how the clips are added in `ViewClipApi.ts`, there need to be some React components that call those methods. This widget has a `<Toggle>` to toggle the range clip, a `<Select>` for X, Y, and Z clip planes, and a `<Button>` to flip the clip plane.
1. ViewClipWidget.tsx   Lines 20-39 - This hook with deps on `showClipBlockState` and `clipPlaneState` will fire when either of those state values are changed by the controls. Depending on the state, the hook will call `ViewClipApi` to clear the clips, add a clip range, or a clip plane.
1. ViewClipWidget.tsx   Lines 53-76 - The final relevant piece of code is an event handler to flip the current clip plane. The existing clip is retrieved with `viewPort.view.getViewClip`. Some checks are run to make sure the clip exists and is a plane. Finally, `negateAllPlanes` is called to flip the plane and it is passed back to `ViewClipApi.setViewClipFromClipPlaneSet`.
